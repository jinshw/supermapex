

## 优化需求

这个是朱看完拥堵路况后提的意见，我整理后的拥堵路况优化：   

> 1：数据准确性提高
> 2：锁定范围等级缩小
> 3：高亮前后端添加起始桩号和终点桩号标识
> 4：更新按钮后，添加【拥堵路段】按钮，用于控制拥堵路段排名面板缩放；
> 5：拥堵路段排名面板下方添加箭头，点击可以查看全部拥堵路况，超图最大高度或用下拉框，或用分页
> 6：超图美工美化

-----



## **获取实时路况排名思路**

* **服务开发思路：**

1. 通过实时路况接口获取 拥堵数据（每5分钟定时执行获取），结果：拥堵数据list列表
2. 根据1中获取的数据、关系表、路网矢量数据，获取到拥堵的路网矢量线段
3. 通过2中的路网矢量线段，获取线段的前后2点坐标（路网上的点），结果：geometries
4. 通过3中获取点，获取距离年报矢量数据最近距离（年报矢量数据空间文件）
5. 通过4中，获得到最近的年报矢量geometry
6. 通过3、4中等到的结果，获取路网数据上的点垂足到年报上的点，即获得线上最近点（垂足点）
7. 通过6中获取的年报上的垂足点，年报路由数据，获得点对应的桩号（点定里程桩）
8. 把里程桩赋值到list中
9. 把list中数据插入数据
10. 在onepic工程中开发对外查询接口服务

* **注意点：**

1. 过滤掉路网不能映射年报矢量上的点
   * 年报查询不到
   * 不能查询年报最近的点（垂点）
   * 不能定位里程桩
2. 路网数据映射年报数据，获取桩号比较繁琐，需要注意性能。现在测试拥堵数据返回50条左右，因需求需要全部计算。预计拥堵数据大于100多条，导致性能下降，5分钟内不能执行完（没有做具体测试）。需要做限制，例如只获取前20条拥堵信息。
3. 由于是通过路网点映射年报矢量，获取的桩号信息，这就导致桩号信息不准确：起始桩号和终点桩号差值 不等于拥堵长度
4. 获取拥堵排名和实时路网全路网刷新时间需要同步
5. 拥堵排名数据是获取的平均值`los=3` ，实时路网刷新需要与它保持一致，即路网也需要获取平均值



## 实时路网刷新

重构